/*
 * MCP
 * ======
 * https://github.com/CounterMarch/MCP
 * MIT Licensed
 */var MCP=function(e){function r(e,t,r,i,s){i=i||!0;modifier=modifier||!0;n[e]||(n[e]=Handlebars.compile($(e).html()));var o=n[e](r);i&&$(t).empty();s?$(o).appendTo(t):$(o).prependTo(t)}this.MCP={version:"0.1.0"};this.options=e||{};this.options.apiBaseUrl=this.options.apiBaseUrl||"";this.options.loadFromCache=this.options.loadFromCache||[];this.options.ready=this.options.ready||function(){};var t=this,n={};this.$queues=[];this.addQueue=function(e,t){e=e||{};var n={options:{},state:"disabled",items:t||[],clock:null};n.options.frequency=e.frequency||5e3;n.options.phonegapEvents=e.phonegapEvents||!1;n.options.handler=e.handler||function(e){console.log(e)};n.options.rotateOnFail=e.rotateOnFail||!1;if(n.options.phonegapEvents){var r=n.options.phonegapEvents.toLowerCase();$(document).on("deviceready",function(){r.indexOf("pause")>=0&&$(document).on("pause",n.stop);r.indexOf("offline")>=0&&$(document).on("offline",n.stop);r.indexOf("resume")>=0&&$(document).on("resume",n.start);r.indexOf("online")>=0&&$(document).on("online",n.start)})}var i=n,s=function o(e){e=e||!1;if(this.state==="disabled")return;if(this.items.length===0){this.stop();return}if(this.state==="processing"&&!e)return;this.state="processing";var t=this.items[0],n=this;this.options.handler(t,function(e){e=e||!1;if(e){n.shift();o.call(n,!0);return}if(n.options.rotateOnFail){if(n.items.length===1)return;n.push(n.shift());o.call(n,!0)}return})};n.start=function(e){e=e||!0;if(this.state==="processing")return;if(this.state==="enabled")return;this.state="enabled";var t=function(){s.apply(n)};e&&setTimeout(t,0);this.clock=setInterval(t,n.options.frequency)};n.stop=function(){if(this.state==="disabled")return;this.state="disabled";clearInterval(this.clock);this.clock=null};n.push=function(e,t){t=t||!1;this.items.push(e);t&&this.start()};n.shift=function(){return this.items.shift()};n.nuke=function(){clearInterval(this.clock);this.clock=null;this.items=[];this.state="disabled"};this.$queues.push(n);return n};var i={};this.onPage=function(e){if(typeof e=="undefined")throw"options argument is required";if(typeof e.page=="undefined")throw"page key of options argument is required";if(typeof e.get=="undefined")throw"get key of options argument is required";if(typeof e.renders=="undefined")throw"renders key of options argument is required";if(typeof e.container=="undefined")throw"container key of options argument is required";$(e.page).on("pageshow",function(){var n=t.options.apiBaseUrl+e.get,s=new Date;if(i[e.page]){if(i[e.page].expires>=s.getTime()){r(e.renders,e.container,i[e.page].data,!0);e.onComplete&&e.onComplete(e,i[e.page].data);return}delete i[e.page]}$.ajax({url:n,type:"GET",data:e.getData,dataType:"json",encoding:"UTF-8",success:function(t,n,s){var o=(new Date).getTime();o+=e.cacheDuration*1e3;i[e.page]={expires:o,data:t};r(e.renders,e.container,t,!0);e.onComplete&&e.onComplete(e,t)},error:function(t,n,r){e.apiError&&e.apiError(t,n,r)},complete:function(e){console.log("MCP XHR Complete:",e)},crossDomain:!0,cache:!1})}).on("pagehide",function(){e.onTearDown&&e.onTearDown(e.page)})};var s=[];for(var o in this.options.loadFromCache)s.push(JSON.parse(localStorage.getItem(this.options.loadFromCache[o]))||null);this.options.ready.apply(this,s);console&&console.log("Acknowledge.")};